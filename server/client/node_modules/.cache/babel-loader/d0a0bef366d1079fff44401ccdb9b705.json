{"ast":null,"code":"'use strict';\n/**\n * Dependencies\n */\n\nvar _slicedToArray = require(\"/Users/tryckhov/Dropbox/Programming/Web Development/React/g12-site/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"/Users/tryckhov/Dropbox/Programming/Web Development/React/g12-site/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/tryckhov/Dropbox/Programming/Web Development/React/g12-site/node_modules/@babel/runtime/helpers/createClass\");\n\nvar EmailAddress = require('./email-address');\n\nvar toCamelCase = require('../helpers/to-camel-case');\n\nvar toSnakeCase = require('../helpers/to-snake-case');\n\nvar deepClone = require('../helpers/deep-clone');\n\nvar merge = require('deepmerge');\n\nvar wrapSubstitutions = require('../helpers/wrap-substitutions');\n/**\n * Personalization class\n */\n\n\nvar Personalization =\n/*#__PURE__*/\nfunction () {\n  /**\n   * Constructor\n   */\n  function Personalization(data) {\n    _classCallCheck(this, Personalization);\n\n    //Init array and object placeholders\n    this.to = [];\n    this.cc = [];\n    this.bcc = [];\n    this.headers = {};\n    this.customArgs = {};\n    this.substitutions = {};\n    this.substitutionWrappers = ['{{', '}}'];\n    this.dynamicTemplateData = {}; //Build from data if given\n\n    if (data) {\n      this.fromData(data);\n    }\n  }\n  /**\n   * From data\n   */\n\n\n  _createClass(Personalization, [{\n    key: \"fromData\",\n    value: function fromData(data) {\n      //Expecting object\n      if (typeof data !== 'object') {\n        throw new Error('Expecting object for Mail data');\n      } //Convert to camel case to make it workable, making a copy to prevent\n      //changes to the original objects\n\n\n      data = deepClone(data);\n      data = toCamelCase(data, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers']); //Extract properties from data\n\n      var _data = data,\n          to = _data.to,\n          cc = _data.cc,\n          bcc = _data.bcc,\n          subject = _data.subject,\n          headers = _data.headers,\n          customArgs = _data.customArgs,\n          sendAt = _data.sendAt,\n          substitutions = _data.substitutions,\n          substitutionWrappers = _data.substitutionWrappers,\n          dynamicTemplateData = _data.dynamicTemplateData; //Set data\n\n      this.setTo(to);\n      this.setCc(cc);\n      this.setBcc(bcc);\n      this.setSubject(subject);\n      this.setHeaders(headers);\n      this.setSubstitutions(substitutions);\n      this.setSubstitutionWrappers(substitutionWrappers);\n      this.setCustomArgs(customArgs);\n      this.setDynamicTemplateData(dynamicTemplateData);\n      this.setSendAt(sendAt);\n    }\n    /**\n     * Set subject\n     */\n\n  }, {\n    key: \"setSubject\",\n    value: function setSubject(subject) {\n      if (typeof subject === 'undefined') {\n        return;\n      }\n\n      if (typeof subject !== 'string') {\n        throw new Error('String expected for `subject`');\n      }\n\n      this.subject = subject;\n    }\n    /**\n     * Set send at\n     */\n\n  }, {\n    key: \"setSendAt\",\n    value: function setSendAt(sendAt) {\n      if (typeof sendAt === 'undefined') {\n        return;\n      }\n\n      if (!Number.isInteger(sendAt)) {\n        throw new Error('Integer expected for `sendAt`');\n      }\n\n      this.sendAt = sendAt;\n    }\n    /**\n     * Set to\n     */\n\n  }, {\n    key: \"setTo\",\n    value: function setTo(to) {\n      if (typeof to === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(to)) {\n        to = [to];\n      }\n\n      this.to = EmailAddress.create(to);\n    }\n    /**\n     * Add a single to\n     */\n\n  }, {\n    key: \"addTo\",\n    value: function addTo(to) {\n      if (typeof to === 'undefined') {\n        return;\n      }\n\n      this.to.push(EmailAddress.create(to));\n    }\n    /**\n     * Set cc\n     */\n\n  }, {\n    key: \"setCc\",\n    value: function setCc(cc) {\n      if (typeof cc === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(cc)) {\n        cc = [cc];\n      }\n\n      this.cc = EmailAddress.create(cc);\n    }\n    /**\n     * Add a single cc\n     */\n\n  }, {\n    key: \"addCc\",\n    value: function addCc(cc) {\n      if (typeof cc === 'undefined') {\n        return;\n      }\n\n      this.cc.push(EmailAddress.create(cc));\n    }\n    /**\n     * Set bcc\n     */\n\n  }, {\n    key: \"setBcc\",\n    value: function setBcc(bcc) {\n      if (typeof bcc === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(bcc)) {\n        bcc = [bcc];\n      }\n\n      this.bcc = EmailAddress.create(bcc);\n    }\n    /**\n     * Add a single bcc\n     */\n\n  }, {\n    key: \"addBcc\",\n    value: function addBcc(bcc) {\n      if (typeof bcc === 'undefined') {\n        return;\n      }\n\n      this.bcc.push(EmailAddress.create(bcc));\n    }\n    /**\n     * Set headers\n     */\n\n  }, {\n    key: \"setHeaders\",\n    value: function setHeaders(headers) {\n      if (typeof headers === 'undefined') {\n        return;\n      }\n\n      if (typeof headers !== 'object' || headers === null) {\n        throw new Error('Object expected for `headers`');\n      }\n\n      this.headers = headers;\n    }\n    /**\n     * Add a header\n     */\n\n  }, {\n    key: \"addHeader\",\n    value: function addHeader(key, value) {\n      if (typeof key !== 'string') {\n        throw new Error('String expected for header key');\n      }\n\n      if (typeof value !== 'string') {\n        throw new Error('String expected for header value');\n      }\n\n      this.headers[key] = value;\n    }\n    /**\n     * Set custom args\n     */\n\n  }, {\n    key: \"setCustomArgs\",\n    value: function setCustomArgs(customArgs) {\n      if (typeof customArgs === 'undefined') {\n        return;\n      }\n\n      if (typeof customArgs !== 'object' || customArgs === null) {\n        throw new Error('Object expected for `customArgs`');\n      }\n\n      this.customArgs = customArgs;\n    }\n    /**\n     * Add a custom arg\n     */\n\n  }, {\n    key: \"addCustomArg\",\n    value: function addCustomArg(key, value) {\n      if (typeof key !== 'string') {\n        throw new Error('String expected for custom arg key');\n      }\n\n      if (typeof value !== 'string') {\n        throw new Error('String expected for custom arg value');\n      }\n\n      this.customArgs[key] = value;\n    }\n    /**\n     * Set substitutions\n     */\n\n  }, {\n    key: \"setSubstitutions\",\n    value: function setSubstitutions(substitutions) {\n      if (typeof substitutions === 'undefined') {\n        return;\n      }\n\n      if (typeof substitutions !== 'object') {\n        throw new Error('Object expected for `substitutions`');\n      }\n\n      this.substitutions = substitutions;\n    }\n    /**\n     * Add a substitution\n     */\n\n  }, {\n    key: \"addSubstitution\",\n    value: function addSubstitution(key, value) {\n      if (typeof key !== 'string') {\n        throw new Error('String expected for substitution key');\n      }\n\n      if (typeof value !== 'string' && typeof value !== 'number') {\n        throw new Error('String or Number expected for substitution value');\n      }\n\n      this.substitutions[key] = value;\n    }\n    /**\n     * Reverse merge substitutions, preserving existing ones\n     */\n\n  }, {\n    key: \"reverseMergeSubstitutions\",\n    value: function reverseMergeSubstitutions(substitutions) {\n      if (typeof substitutions === 'undefined' || substitutions === null) {\n        return;\n      }\n\n      if (typeof substitutions !== 'object') {\n        throw new Error('Object expected for `substitutions` in reverseMergeSubstitutions');\n      }\n\n      this.substitutions = Object.assign({}, substitutions, this.substitutions);\n    }\n    /**\n     * Set substitution wrappers\n     */\n\n  }, {\n    key: \"setSubstitutionWrappers\",\n    value: function setSubstitutionWrappers(wrappers) {\n      if (typeof wrappers === 'undefined' || wrappers === null) {\n        return;\n      }\n\n      if (!Array.isArray(wrappers) || wrappers.length !== 2) {\n        throw new Error('Array expected with two elements for `substitutionWrappers`');\n      }\n\n      this.substitutionWrappers = wrappers;\n    }\n    /**\n     * Reverse merge dynamic template data, preserving existing ones\n     */\n\n  }, {\n    key: \"deepMergeDynamicTemplateData\",\n    value: function deepMergeDynamicTemplateData(dynamicTemplateData) {\n      if (typeof dynamicTemplateData === 'undefined' || dynamicTemplateData === null) {\n        return;\n      }\n\n      if (typeof dynamicTemplateData !== 'object') {\n        throw new Error('Object expected for `dynamicTemplateData` in deepMergeDynamicTemplateData');\n      }\n\n      this.dynamicTemplateData = merge(dynamicTemplateData, this.dynamicTemplateData);\n    }\n    /**\n     * Set dynamic template data\n     */\n\n  }, {\n    key: \"setDynamicTemplateData\",\n    value: function setDynamicTemplateData(dynamicTemplateData) {\n      if (typeof dynamicTemplateData === 'undefined') {\n        return;\n      }\n\n      if (typeof dynamicTemplateData !== 'object') {\n        throw new Error('Object expected for `dynamicTemplateData`');\n      }\n\n      this.dynamicTemplateData = dynamicTemplateData;\n    }\n    /**\n     * To JSON\n     */\n\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      //Get data from self\n      var to = this.to,\n          cc = this.cc,\n          bcc = this.bcc,\n          subject = this.subject,\n          headers = this.headers,\n          customArgs = this.customArgs,\n          sendAt = this.sendAt,\n          substitutions = this.substitutions,\n          substitutionWrappers = this.substitutionWrappers,\n          dynamicTemplateData = this.dynamicTemplateData; //Initialize with mandatory values\n\n      var json = {\n        to: to\n      }; //Arrays\n\n      if (Array.isArray(cc) && cc.length > 0) {\n        json.cc = cc;\n      }\n\n      if (Array.isArray(bcc) && bcc.length > 0) {\n        json.bcc = bcc;\n      } //Objects\n\n\n      if (Object.keys(headers).length > 0) {\n        json.headers = headers;\n      }\n\n      if (substitutions && Object.keys(substitutions).length > 0) {\n        var _substitutionWrappers = _slicedToArray(substitutionWrappers, 2),\n            left = _substitutionWrappers[0],\n            right = _substitutionWrappers[1];\n\n        json.substitutions = wrapSubstitutions(substitutions, left, right);\n      }\n\n      if (Object.keys(customArgs).length > 0) {\n        json.customArgs = customArgs;\n      }\n\n      if (dynamicTemplateData && Object.keys(dynamicTemplateData).length > 0) {\n        json.dynamicTemplateData = dynamicTemplateData;\n      } //Simple properties\n\n\n      if (typeof subject !== 'undefined') {\n        json.subject = subject;\n      }\n\n      if (typeof sendAt !== 'undefined') {\n        json.sendAt = sendAt;\n      } //Return as snake cased object\n\n\n      return toSnakeCase(json, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers']);\n    }\n  }]);\n\n  return Personalization;\n}(); //Export class\n\n\nmodule.exports = Personalization;","map":null,"metadata":{},"sourceType":"script"}