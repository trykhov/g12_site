{"ast":null,"code":"'use strict';\n/**\n * Dependencies\n */\n\nvar _classCallCheck = require(\"/Users/tryckhov/Dropbox/Programming/Web Development/React/g12-site/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/tryckhov/Dropbox/Programming/Web Development/React/g12-site/node_modules/@babel/runtime/helpers/createClass\");\n\nvar EmailAddress = require('./email-address');\n\nvar Personalization = require('./personalization');\n\nvar toCamelCase = require('../helpers/to-camel-case');\n\nvar toSnakeCase = require('../helpers/to-snake-case');\n\nvar deepClone = require('../helpers/deep-clone');\n\nvar arrayToJSON = require('../helpers/array-to-json');\n/**\n * Mail class\n */\n\n\nvar Mail =\n/*#__PURE__*/\nfunction () {\n  /**\n   * Constructor\n   */\n  function Mail(data) {\n    _classCallCheck(this, Mail);\n\n    //Initialize array and object properties\n    this.isDynamic = false;\n    this.personalizations = [];\n    this.attachments = [];\n    this.content = [];\n    this.categories = [];\n    this.headers = {};\n    this.sections = {};\n    this.customArgs = {};\n    this.trackingSettings = {};\n    this.mailSettings = {};\n    this.asm = {}; //Helper properties\n\n    this.substitutions = null;\n    this.substitutionWrappers = null;\n    this.dynamicTemplateData = null; //Process data if given\n\n    if (data) {\n      this.fromData(data);\n    }\n  }\n  /**\n   * Build from data\n   */\n\n\n  _createClass(Mail, [{\n    key: \"fromData\",\n    value: function fromData(data) {\n      var _this = this;\n\n      //Expecting object\n      if (typeof data !== 'object') {\n        throw new Error('Expecting object for Mail data');\n      } //Convert to camel case to make it workable, making a copy to prevent\n      //changes to the original objects\n\n\n      data = deepClone(data);\n      data = toCamelCase(data, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers', 'sections']); //Extract properties from data\n\n      var _data = data,\n          to = _data.to,\n          from = _data.from,\n          replyTo = _data.replyTo,\n          cc = _data.cc,\n          bcc = _data.bcc,\n          sendAt = _data.sendAt,\n          subject = _data.subject,\n          text = _data.text,\n          html = _data.html,\n          content = _data.content,\n          templateId = _data.templateId,\n          personalizations = _data.personalizations,\n          attachments = _data.attachments,\n          ipPoolName = _data.ipPoolName,\n          batchId = _data.batchId,\n          sections = _data.sections,\n          headers = _data.headers,\n          categories = _data.categories,\n          category = _data.category,\n          customArgs = _data.customArgs,\n          asm = _data.asm,\n          mailSettings = _data.mailSettings,\n          trackingSettings = _data.trackingSettings,\n          substitutions = _data.substitutions,\n          substitutionWrappers = _data.substitutionWrappers,\n          dynamicTemplateData = _data.dynamicTemplateData,\n          isMultiple = _data.isMultiple; //Set data\n\n      this.setFrom(from);\n      this.setReplyTo(replyTo);\n      this.setSubject(subject);\n      this.setSendAt(sendAt);\n      this.setTemplateId(templateId);\n      this.setBatchId(batchId);\n      this.setIpPoolName(ipPoolName);\n      this.setAttachments(attachments);\n      this.setContent(content);\n      this.setSections(sections);\n      this.setHeaders(headers);\n      this.setCategories(category);\n      this.setCategories(categories);\n      this.setCustomArgs(customArgs);\n      this.setAsm(asm);\n      this.setMailSettings(mailSettings);\n      this.setTrackingSettings(trackingSettings);\n\n      if (this.isDynamic) {\n        this.setDynamicTemplateData(dynamicTemplateData);\n      } else {\n        this.setSubstitutions(substitutions);\n        this.setSubstitutionWrappers(substitutionWrappers);\n      } //Add contents from text/html properties\n\n\n      this.addTextContent(text);\n      this.addHtmlContent(html); //Using \"to\" property for personalizations\n\n      if (personalizations) {\n        this.setPersonalizations(personalizations);\n      } //Multiple individual emails\n      else if (isMultiple && Array.isArray(to)) {\n          to.forEach(function (to) {\n            return _this.addTo(to, cc, bcc);\n          });\n        } //Single email (possibly with multiple recipients in the to field)\n        else {\n            this.addTo(to, cc, bcc);\n          }\n    }\n    /**\n     * Set from email\n     */\n\n  }, {\n    key: \"setFrom\",\n    value: function setFrom(from) {\n      if (typeof from === 'undefined') {\n        return;\n      }\n\n      this.from = EmailAddress.create(from);\n    }\n    /**\n     * Set reply to\n     */\n\n  }, {\n    key: \"setReplyTo\",\n    value: function setReplyTo(replyTo) {\n      if (typeof replyTo === 'undefined') {\n        return;\n      }\n\n      this.replyTo = EmailAddress.create(replyTo);\n    }\n    /**\n     * Set subject\n     */\n\n  }, {\n    key: \"setSubject\",\n    value: function setSubject(subject) {\n      if (typeof subject === 'undefined') {\n        return;\n      }\n\n      if (typeof subject !== 'string') {\n        throw new Error('String expected for `subject`');\n      }\n\n      this.subject = subject;\n    }\n    /**\n     * Set send at\n     */\n\n  }, {\n    key: \"setSendAt\",\n    value: function setSendAt(sendAt) {\n      if (typeof sendAt === 'undefined') {\n        return;\n      }\n\n      if (!Number.isInteger(sendAt)) {\n        throw new Error('Integer expected for `sendAt`');\n      }\n\n      this.sendAt = sendAt;\n    }\n    /**\n     * Set template ID, also checks if the template is dynamic or legacy\n     */\n\n  }, {\n    key: \"setTemplateId\",\n    value: function setTemplateId(templateId) {\n      if (typeof templateId === 'undefined') {\n        return;\n      }\n\n      if (typeof templateId !== 'string') {\n        throw new Error('String expected for `templateId`');\n      }\n\n      if (templateId.indexOf('d-') === 0) {\n        this.isDynamic = true;\n      }\n\n      this.templateId = templateId;\n    }\n    /**\n     * Set batch ID\n     */\n\n  }, {\n    key: \"setBatchId\",\n    value: function setBatchId(batchId) {\n      if (typeof batchId === 'undefined') {\n        return;\n      }\n\n      if (typeof batchId !== 'string') {\n        throw new Error('String expected for `batchId`');\n      }\n\n      this.batchId = batchId;\n    }\n    /**\n     * Set IP pool name\n     */\n\n  }, {\n    key: \"setIpPoolName\",\n    value: function setIpPoolName(ipPoolName) {\n      if (typeof ipPoolName === 'undefined') {\n        return;\n      }\n\n      if (typeof ipPoolName !== 'string') {\n        throw new Error('String expected for `ipPoolName`');\n      }\n\n      this.ipPoolName = ipPoolName;\n    }\n    /**\n     * Set ASM\n     */\n\n  }, {\n    key: \"setAsm\",\n    value: function setAsm(asm) {\n      if (typeof asm === 'undefined') {\n        return;\n      }\n\n      if (typeof asm !== 'object') {\n        throw new Error('Object expected for `asm`');\n      }\n\n      this.asm = asm;\n    }\n    /**\n     * Set personalizations\n     */\n\n  }, {\n    key: \"setPersonalizations\",\n    value: function setPersonalizations(personalizations) {\n      var _this2 = this;\n\n      if (typeof personalizations === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(personalizations)) {\n        throw new Error('Array expected for `personalizations`');\n      } //Clear and use add helper to add one by one\n\n\n      this.personalizations = [];\n      personalizations.forEach(function (personalization) {\n        return _this2.addPersonalization(personalization);\n      });\n    }\n    /**\n     * Add personalization\n     */\n\n  }, {\n    key: \"addPersonalization\",\n    value: function addPersonalization(personalization) {\n      //We should either send substitutions or dynamicTemplateData\n      //depending on the templateId\n      if (this.isDynamic && personalization.substitutions) {\n        delete personalization.substitutions;\n      } else if (personalization.dynamicTemplateData) {\n        delete personalization.dynamicTemplateData;\n      } //Convert to class if needed\n\n\n      if (!(personalization instanceof Personalization)) {\n        personalization = new Personalization(personalization);\n      } //If this is dynamic, set dynamicTemplateData, or set substitutions\n\n\n      if (this.isDynamic) {\n        this.applyDynamicTemplateData(personalization);\n      } else {\n        this.applySubstitutions(personalization);\n      } //Push personalization to array\n\n\n      this.personalizations.push(personalization);\n    }\n    /**\n     * Convenience method for quickly creating personalizations\n     */\n\n  }, {\n    key: \"addTo\",\n    value: function addTo(to, cc, bcc) {\n      if (typeof to === 'undefined' && typeof cc === 'undefined' && typeof bcc === 'undefined') {\n        throw new Error('Provide at least one of to, cc or bcc');\n      }\n\n      this.addPersonalization(new Personalization({\n        to: to,\n        cc: cc,\n        bcc: bcc\n      }));\n    }\n    /**\n     * Set substitutions\n     */\n\n  }, {\n    key: \"setSubstitutions\",\n    value: function setSubstitutions(substitutions) {\n      if (typeof substitutions === 'undefined') {\n        return;\n      }\n\n      if (typeof substitutions !== 'object') {\n        throw new Error('Object expected for `substitutions`');\n      }\n\n      this.substitutions = substitutions;\n    }\n    /**\n     * Set substitution wrappers\n     */\n\n  }, {\n    key: \"setSubstitutionWrappers\",\n    value: function setSubstitutionWrappers(wrappers) {\n      if (typeof wrappers === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(wrappers) || wrappers.length !== 2) {\n        throw new Error('Array expected with two elements for `substitutionWrappers`');\n      }\n\n      this.substitutionWrappers = wrappers;\n    }\n    /**\n     * Helper which applies globally set substitutions to personalizations\n     */\n\n  }, {\n    key: \"applySubstitutions\",\n    value: function applySubstitutions(personalization) {\n      if (personalization instanceof Personalization) {\n        personalization.reverseMergeSubstitutions(this.substitutions);\n        personalization.setSubstitutionWrappers(this.substitutionWrappers);\n      }\n    }\n    /**\n     * Helper which applies globally set dynamic_template_data to personalizations\n     */\n\n  }, {\n    key: \"applyDynamicTemplateData\",\n    value: function applyDynamicTemplateData(personalization) {\n      if (personalization instanceof Personalization) {\n        personalization.deepMergeDynamicTemplateData(this.dynamicTemplateData);\n      }\n    }\n    /**\n     * Set dynamicTemplateData\n     */\n\n  }, {\n    key: \"setDynamicTemplateData\",\n    value: function setDynamicTemplateData(dynamicTemplateData) {\n      if (typeof dynamicTemplateData === 'undefined') {\n        return;\n      }\n\n      if (typeof dynamicTemplateData !== 'object') {\n        throw new Error('Object expected for `dynamicTemplateData`');\n      }\n\n      this.dynamicTemplateData = dynamicTemplateData;\n    }\n    /**\n     * Set content\n     */\n\n  }, {\n    key: \"setContent\",\n    value: function setContent(content) {\n      if (typeof content === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(content)) {\n        throw new Error('Array expected for `content`');\n      }\n\n      this.content = content;\n    }\n    /**\n     * Add content\n     */\n\n  }, {\n    key: \"addContent\",\n    value: function addContent(content) {\n      if (typeof content !== 'object') {\n        throw new Error('Object expected for `content`');\n      }\n\n      this.content.push(content);\n    }\n    /**\n     * Add text content\n     */\n\n  }, {\n    key: \"addTextContent\",\n    value: function addTextContent(text) {\n      if (typeof text === 'undefined') {\n        return;\n      }\n\n      if (typeof text !== 'string') {\n        throw new Error('String expected for `text`');\n      }\n\n      this.addContent({\n        value: text,\n        type: 'text/plain'\n      });\n    }\n    /**\n     * Add HTML content\n     */\n\n  }, {\n    key: \"addHtmlContent\",\n    value: function addHtmlContent(html) {\n      if (typeof html === 'undefined') {\n        return;\n      }\n\n      if (typeof html !== 'string') {\n        throw new Error('String expected for `html`');\n      }\n\n      this.addContent({\n        value: html,\n        type: 'text/html'\n      });\n    }\n    /**\n     * Set attachments\n     */\n\n  }, {\n    key: \"setAttachments\",\n    value: function setAttachments(attachments) {\n      if (typeof attachments === 'undefined') {\n        return;\n      }\n\n      if (!Array.isArray(attachments)) {\n        throw new Error('Array expected for `attachments`');\n      }\n\n      this.attachments = attachments;\n    }\n    /**\n     * Add attachment\n     */\n\n  }, {\n    key: \"addAttachment\",\n    value: function addAttachment(attachment) {\n      if (typeof attachment !== 'object') {\n        throw new Error('Object expected for `attachment`');\n      }\n\n      this.attachments.push(attachment);\n    }\n    /**\n     * Set categories\n     */\n\n  }, {\n    key: \"setCategories\",\n    value: function setCategories(categories) {\n      if (typeof categories === 'undefined') {\n        return;\n      }\n\n      if (typeof categories === 'string') {\n        categories = [categories];\n      }\n\n      if (!Array.isArray(categories) || !categories.every(function (cat) {\n        return typeof cat === 'string';\n      })) {\n        throw new Error('Array of strings expected for `categories`');\n      }\n\n      this.categories = categories;\n    }\n    /**\n     * Add category\n     */\n\n  }, {\n    key: \"addCategory\",\n    value: function addCategory(category) {\n      if (typeof category !== 'string') {\n        throw new Error('String expected for `category`');\n      }\n\n      this.categories.push(category);\n    }\n    /**\n     * Set headers\n     */\n\n  }, {\n    key: \"setHeaders\",\n    value: function setHeaders(headers) {\n      if (typeof headers === 'undefined') {\n        return;\n      }\n\n      if (typeof headers !== 'object') {\n        throw new Error('Object expected for `headers`');\n      }\n\n      this.headers = headers;\n    }\n    /**\n     * Add a header\n     */\n\n  }, {\n    key: \"addHeader\",\n    value: function addHeader(key, value) {\n      if (typeof key !== 'string') {\n        throw new Error('String expected for header key');\n      }\n\n      if (typeof value !== 'string') {\n        throw new Error('String expected for header value');\n      }\n\n      this.headers[key] = value;\n    }\n    /**\n     * Set sections\n     */\n\n  }, {\n    key: \"setSections\",\n    value: function setSections(sections) {\n      if (typeof sections === 'undefined') {\n        return;\n      }\n\n      if (typeof sections !== 'object') {\n        throw new Error('Object expected for `sections`');\n      }\n\n      this.sections = sections;\n    }\n    /**\n     * Set custom args\n     */\n\n  }, {\n    key: \"setCustomArgs\",\n    value: function setCustomArgs(customArgs) {\n      if (typeof customArgs === 'undefined') {\n        return;\n      }\n\n      if (typeof customArgs !== 'object') {\n        throw new Error('Object expected for `customArgs`');\n      }\n\n      this.customArgs = customArgs;\n    }\n    /**\n     * Set tracking settings\n     */\n\n  }, {\n    key: \"setTrackingSettings\",\n    value: function setTrackingSettings(settings) {\n      if (typeof settings === 'undefined') {\n        return;\n      }\n\n      if (typeof settings !== 'object') {\n        throw new Error('Object expected for `trackingSettings`');\n      }\n\n      this.trackingSettings = settings;\n    }\n    /**\n     * Set mail settings\n     */\n\n  }, {\n    key: \"setMailSettings\",\n    value: function setMailSettings(settings) {\n      if (typeof settings === 'undefined') {\n        return;\n      }\n\n      if (typeof settings !== 'object') {\n        throw new Error('Object expected for `mailSettings`');\n      }\n\n      this.mailSettings = settings;\n    }\n    /**\n     * To JSON\n     */\n\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      //Extract properties from self\n      var from = this.from,\n          replyTo = this.replyTo,\n          sendAt = this.sendAt,\n          subject = this.subject,\n          content = this.content,\n          templateId = this.templateId,\n          personalizations = this.personalizations,\n          attachments = this.attachments,\n          ipPoolName = this.ipPoolName,\n          batchId = this.batchId,\n          asm = this.asm,\n          sections = this.sections,\n          headers = this.headers,\n          categories = this.categories,\n          customArgs = this.customArgs,\n          mailSettings = this.mailSettings,\n          trackingSettings = this.trackingSettings; //Initialize with mandatory values\n\n      var json = {\n        from: from,\n        subject: subject,\n        personalizations: arrayToJSON(personalizations)\n      }; //Array properties\n\n      if (Array.isArray(attachments) && attachments.length > 0) {\n        json.attachments = arrayToJSON(attachments);\n      }\n\n      if (Array.isArray(categories) && categories.length > 0) {\n        json.categories = categories.filter(function (cat) {\n          return cat !== '';\n        });\n      }\n\n      if (Array.isArray(content) && content.length > 0) {\n        json.content = arrayToJSON(content);\n      } //Object properties\n\n\n      if (Object.keys(headers).length > 0) {\n        json.headers = headers;\n      }\n\n      if (Object.keys(mailSettings).length > 0) {\n        json.mailSettings = mailSettings;\n      }\n\n      if (Object.keys(trackingSettings).length > 0) {\n        json.trackingSettings = trackingSettings;\n      }\n\n      if (Object.keys(customArgs).length > 0) {\n        json.customArgs = customArgs;\n      }\n\n      if (Object.keys(sections).length > 0) {\n        json.sections = sections;\n      }\n\n      if (Object.keys(asm).length > 0) {\n        json.asm = asm;\n      } //Simple properties\n\n\n      if (typeof replyTo !== 'undefined') {\n        json.replyTo = replyTo;\n      }\n\n      if (typeof sendAt !== 'undefined') {\n        json.sendAt = sendAt;\n      }\n\n      if (typeof batchId !== 'undefined') {\n        json.batchId = batchId;\n      }\n\n      if (typeof templateId !== 'undefined') {\n        json.templateId = templateId;\n      }\n\n      if (typeof ipPoolName !== 'undefined') {\n        json.ipPoolName = ipPoolName;\n      } //Return as snake cased object\n\n\n      return toSnakeCase(json, ['substitutions', 'dynamicTemplateData', 'customArgs', 'headers', 'sections']);\n    }\n    /**************************************************************************\n     * Static helpers\n     ***/\n\n    /**\n     * Create a Mail instance from given data\n     */\n\n  }], [{\n    key: \"create\",\n    value: function create(data) {\n      var _this3 = this;\n\n      //Array?\n      if (Array.isArray(data)) {\n        return data.filter(function (item) {\n          return !!item;\n        }).map(function (item) {\n          return _this3.create(item);\n        });\n      } //Already instance of Mail class?\n\n\n      if (data instanceof Mail) {\n        return data;\n      } //Create instance\n\n\n      return new Mail(data);\n    }\n  }]);\n\n  return Mail;\n}(); //Export class\n\n\nmodule.exports = Mail;","map":null,"metadata":{},"sourceType":"script"}